

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>CAI Claude Instant &#8212; Jupyter Book Demo</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'prompt-generation-claude-instant-v1';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CAI Prompt" href="README.html" />
    <link rel="prev" title="CAI Claude" href="prompt-generation-claude-v1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="prompt-generation-claude-v1.html">
  
  
  
  
  
    <p class="title logo__title">Jupyter Book Demo</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="prompt-generation-claude-v1.html">
                    CAI Claude
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">CAI Claude Instant</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">CAI Prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="jokes.html">CAI Jokes</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/dan-kwiat/cai-prompt/blob/main/prompt-generation-claude-instant-v1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/dan-kwiat/cai-prompt" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/dan-kwiat/cai-prompt/issues/new?title=Issue%20on%20page%20%2Fprompt-generation-claude-instant-v1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/prompt-generation-claude-instant-v1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CAI Claude Instant</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-concepts">Generate concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-naive-responses">Generate naive responses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#critique">Critique</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewrite">Rewrite</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewrites-as-few-shot">Rewrites as few-shot</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cai-claude-instant">
<h1>CAI Claude Instant<a class="headerlink" href="#cai-claude-instant" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load ./claude.py</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">anthropic</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="n">load_dotenv</span><span class="p">()</span>


<span class="n">anthropic_client</span> <span class="o">=</span> <span class="n">anthropic</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ANTHROPIC_API_KEY&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">claude_v1_latest</span> <span class="o">=</span> <span class="s1">&#39;claude-v1&#39;</span>
    <span class="n">claude_v1_0</span> <span class="o">=</span> <span class="s2">&quot;claude-v1.0&quot;</span>
    <span class="n">claude_v1_2</span> <span class="o">=</span> <span class="s2">&quot;claude-v1.2&quot;</span>
    <span class="n">claude_v1_3</span> <span class="o">=</span> <span class="s2">&quot;claude-v1.3&quot;</span>
    <span class="n">claude_instant_v1_latest</span> <span class="o">=</span> <span class="s2">&quot;claude-instant-v1&quot;</span>
    <span class="n">claude_instant_v1_0</span> <span class="o">=</span> <span class="s2">&quot;claude-instant-v1.0&quot;</span>


<span class="k">class</span> <span class="nc">PromptType</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">human_message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">claude_v1_latest</span>
    <span class="n">temp_0_1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">max_tokens_to_sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">assistant_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">response_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">get_claude_response</span><span class="p">(</span>
    <span class="n">prompt_args</span><span class="p">:</span> <span class="n">PromptType</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">wrapped_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">anthropic</span><span class="o">.</span><span class="n">HUMAN_PROMPT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">human_message</span><span class="si">}{</span><span class="n">anthropic</span><span class="o">.</span><span class="n">AI_PROMPT</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">assistant_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">wrapped_prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">assistant_prefix</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">anthropic_client</span><span class="o">.</span><span class="n">completion</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">wrapped_prompt</span><span class="p">,</span>
        <span class="n">stop_sequences</span><span class="o">=</span><span class="p">[</span><span class="n">anthropic</span><span class="o">.</span><span class="n">HUMAN_PROMPT</span><span class="p">],</span>
        <span class="n">model</span><span class="o">=</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">max_tokens_to_sample</span><span class="o">=</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">max_tokens_to_sample</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">temp_0_1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;completion&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">response_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># This is often useful to clean up after we&#39;ve used `assistant_prefix` e.g. to start a numbered list of items.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prompt_args</span><span class="o">.</span><span class="n">response_prefix</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">text</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">claude_instant_v1_latest</span>

<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">constitution_rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Instructions must explicitly describe the tone that the editor adpots.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:</span><span class="se">\n\n</span><span class="s2">&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;</span><span class="se">\n\n</span><span class="s2">[Rest of instruction goes here]&#39;.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Instructions which involve multiple steps should be broken down into numbered subtasks.&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;Instructions must include explicit examples. For example, if the instruction is to check for spelling errors, it should include an example typo and its correction.&quot;,</span>
<span class="p">]</span>
<span class="n">constitution_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">constitution_rules</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">get_concepts_prompt</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptType</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptType</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">temp_0_1</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">human_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Generate a list of </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> tasks that a Copy Editor might do as part of their job, given a written article. The output of each completed task should be written text. Write each task on a separate, numbered line.&quot;</span><span class="p">,</span>
        <span class="n">assistant_prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Here are </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> tasks:</span><span class="se">\n\n</span><span class="s2">1.&quot;</span><span class="p">,</span>
        <span class="n">response_prefix</span><span class="o">=</span><span class="s2">&quot;1.&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_naive_response_prompt</span><span class="p">(</span><span class="n">concept</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptType</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptType</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">temp_0_1</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="n">human_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;I have an AI agent which acts as a Copy Editor and I want it to complete the following task:</span>

<span class="s2">&lt;task&gt;</span>
<span class="si">{</span><span class="n">concept</span><span class="si">}</span>
<span class="s2">&lt;/task&gt;</span>

<span class="s2">The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_critique_prompt</span><span class="p">(</span><span class="n">naive_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptType</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptType</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">temp_0_1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">human_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Here is an instruction to an AI agent which acts as a Copy Editor:</span>

<span class="s2">&lt;instruction&gt;</span>
<span class="si">{</span><span class="n">naive_response</span><span class="si">}</span>
<span class="s2">&lt;/instruction&gt;</span>

<span class="s2">There may be some problems with this instruction. In particular, the instruction must abide by the following rules:</span>

<span class="s2">&lt;rules&gt;</span>
<span class="si">{</span><span class="n">constitution_str</span><span class="si">}</span>
<span class="s2">&lt;/rules&gt;</span>

<span class="s2">List each rule that the instruction breaks. State the rule verbatim, then describe how the instruction breaks the rule.</span>

<span class="s2">For example, if the instruction breaks rule 1, you would write:</span>

<span class="s2">The instruction breaks the following rules:</span>
<span class="s2">1. Rule: </span><span class="si">{</span><span class="n">constitution_rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Reason: ...&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_rewrite_prompt</span><span class="p">(</span><span class="n">naive_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">critique</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptType</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptType</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">temp_0_1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">human_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Here is an instruction to an AI agent which acts as a Copy Editor:</span>

<span class="s2">&lt;instruction&gt;</span>
<span class="si">{</span><span class="n">naive_response</span><span class="si">}</span>
<span class="s2">&lt;/instruction&gt;</span>

<span class="s2">The instruction is supposed to follow certain rules, but it breaks them as follows:</span>

<span class="s2">&lt;issues&gt;</span>
<span class="si">{</span><span class="n">critique</span><span class="si">}</span>
<span class="s2">&lt;/issues&gt;</span>

<span class="s2">Rewrite the instruction to address these issues. Do not enclose your answer in &lt;instruction&gt; tags.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">assistant_prefix</span><span class="o">=</span><span class="s2">&quot;Here is the rewritten instruction:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="generate-concepts">
<h2>Generate concepts<a class="headerlink" href="#generate-concepts" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">concepts_string</span> <span class="o">=</span> <span class="n">get_claude_response</span><span class="p">(</span><span class="n">get_concepts_prompt</span><span class="p">(</span><span class="n">num_samples</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">concepts_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. Check for spelling and grammatical errors.
2. Ensure consistency in style, formatting, and terminology. 
3. Verify facts and quotations within the text.
4. Identify and resolve ambiguous or unclear phrases.  
5. Make recommendations for restructuring or reorganizing the content for clarity and flow.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">extract_items</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d+\.\s&#39;</span><span class="p">,</span> <span class="n">stripped</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d+\.\s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">stripped</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="n">concepts</span> <span class="o">=</span> <span class="n">extract_items</span><span class="p">(</span><span class="n">concepts_string</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_samples</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">num_samples</span><span class="si">}</span><span class="s2"> concepts, but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span><span class="si">}</span><span class="s2"> concepts&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Got 5 concepts
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-naive-responses">
<h2>Generate naive responses<a class="headerlink" href="#generate-naive-responses" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p><strong>Terminology</strong> - here we’re prompting an LLM to generate prompts, which is confusing. We’ll use the word “prompt” to refer to the initial input, and “response” to refer to the output</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_naive_response</span><span class="p">(</span><span class="n">concept</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_claude_response</span><span class="p">(</span><span class="n">get_naive_response_prompt</span><span class="p">(</span><span class="n">concept</span><span class="p">))</span>


<span class="c1"># Concurrently (speeds up openai responses, not possible with anthropic)</span>
<span class="c1"># with concurrent.futures.ThreadPoolExecutor() as executor:</span>
<span class="c1">#     naive_responses = list(executor.map(lambda x: get_naive_response(</span>
<span class="c1">#         x[0], x[1]), [(concept, i) for i, concept in enumerate(concepts)]))</span>

<span class="c1"># Sequentially</span>
<span class="n">naive_responses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">concept</span> <span class="ow">in</span> <span class="n">concepts</span><span class="p">:</span>
    <span class="n">naive_responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_naive_response</span><span class="p">(</span><span class="n">concept</span><span class="p">))</span>

<span class="n">tasksResponsesString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">===</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;TASK:</span><span class="se">\n</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">NAIVE RESPONSE:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">task</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">concepts</span><span class="p">,</span> <span class="n">naive_responses</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tasksResponsesString</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TASK:
Check for spelling and grammatical errors.

NAIVE RESPONSE:
 Check text for spelling and grammar issues.


===


TASK:
Ensure consistency in style, formatting, and terminology.

NAIVE RESPONSE:
 Revise text for consistent style, format, and word choice throughout.


===


TASK:
Verify facts and quotations within the text.

NAIVE RESPONSE:
 Verify that all facts and quotations within the text are accurate.


===


TASK:
Identify and resolve ambiguous or unclear phrases.

NAIVE RESPONSE:
 Revise text to resolve ambiguity and clarify meaning.


===


TASK:
Make recommendations for restructuring or reorganizing the content for clarity and flow.

NAIVE RESPONSE:
 Restructure and reorder content to improve clarity and flow. Provide recommendations in writing.
</pre></div>
</div>
</div>
</div>
<p>Most of these responses are slightly more detailed rewrites of the corresponding task. This is a good start, but ultimately not very useful and doesn’t demonstrate most of the good practices in prompt design.</p>
</section>
<section id="critique">
<h2>Critique<a class="headerlink" href="#critique" title="Permalink to this heading">#</a></h2>
<p>Here’s what an example prompt looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_critique_prompt</span><span class="p">(</span><span class="n">naive_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">human_message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Here is an instruction to an AI agent which acts as a Copy Editor:

&lt;instruction&gt;
 Check text for spelling and grammar issues.
&lt;/instruction&gt;

There may be some problems with this instruction. In particular, the instruction must abide by the following rules:

&lt;rules&gt;
1. Instructions must explicitly describe the tone that the editor adpots.
2. Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.
3. Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:

&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

[Rest of instruction goes here]&#39;.
4. Instructions which involve multiple steps should be broken down into numbered subtasks.
&lt;/rules&gt;

List each rule that the instruction breaks. State the rule verbatim, then describe how the instruction breaks the rule.

For example, if the instruction breaks rule 1, you would write:

The instruction breaks the following rules:
1. Rule: Instructions must explicitly describe the tone that the editor adpots. - Reason: ...
</pre></div>
</div>
</div>
</div>
<p>Now let’s execute the critique prompt on each of the naive responses:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_critique</span><span class="p">(</span><span class="n">naive_response</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_claude_response</span><span class="p">(</span><span class="n">get_critique_prompt</span><span class="p">(</span><span class="n">naive_response</span><span class="p">))</span>

<span class="c1"># Concurrently:</span>
<span class="c1"># with concurrent.futures.ThreadPoolExecutor() as executor:</span>
<span class="c1">#     critiques = list(executor.map(lambda x: get_critique(x[0], x[1]), [</span>
<span class="c1">#                      (response, i) for i, response in enumerate(naive_responses)]))</span>


<span class="c1"># Sequentially:</span>
<span class="n">critiques</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">naive_response</span> <span class="ow">in</span> <span class="n">naive_responses</span><span class="p">:</span>
    <span class="n">critiques</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_critique</span><span class="p">(</span><span class="n">naive_response</span><span class="p">))</span>

<span class="n">responseCritiqueString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">===</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NAIVE RESPONSE:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">CRITIQUE:</span><span class="se">\n</span><span class="si">{</span><span class="n">critique</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">critique</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">naive_responses</span><span class="p">,</span> <span class="n">critiques</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">responseCritiqueString</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NAIVE RESPONSE:
 Check text for spelling and grammar issues.

CRITIQUE:
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adopts.  
         - Reason: The instruction does not specify the tone that the editor should adopt.

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.
         - Reason: The instruction does not specify the number of words in the editor&#39;s response.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:  
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;
[Rest of instruction goes here].&#39;
         - Reason: The instruction does not reference any article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks.
         - Reason: The instruction consists of a single step and is not broken down into numbered subtasks.


===


NAIVE RESPONSE:
 Revise text for consistent style, format, and word choice throughout.

CRITIQUE:
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adpots. - Reason: The instruction does not specify the tone the editor should adopt.  

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task. - Reason: The instruction does not specify the number of words the editor&#39;s response should contain.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:
&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt; 
[Rest of instruction goes here]&#39;. - Reason: The instruction does not reference any specific article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks. - Reason: The instruction consists of a single unnumbered step.


===


NAIVE RESPONSE:
 Verify that all facts and quotations within the text are accurate.

CRITIQUE:
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adpots.
Reason: The instruction does not specify the tone that the editor should adopt.

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.
Reason: The instruction does not specify the number of words in the editor&#39;s response.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:  
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;
[Rest of instruction goes here]&#39;
Reason: The instruction does not reference any specific article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks.
Reason: The instruction contains a single unnumbered step.


===


NAIVE RESPONSE:
 Revise text to resolve ambiguity and clarify meaning.

CRITIQUE:
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adpots.  
Reason: The instruction does not specify the tone that the editor should adopt.

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.
Reason: The instruction does not specify the number of words the editor&#39;s response should be.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;
[Rest of instruction goes here]&#39;
Reason: The instruction does not reference any article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks.  
Reason: The instruction consists of a single broad step and is not broken down into numbered subtasks.


===


NAIVE RESPONSE:
 Restructure and reorder content to improve clarity and flow. Provide recommendations in writing.

CRITIQUE:
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adpots. - Reason: The instruction does not specify the tone the editor should adopt.  

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task. - Reason: The instruction does not specify the number of words the editor&#39;s response should contain.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:  
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;  

[Rest of instruction goes here]&#39;. - Reason: The instruction does not reference any specific article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks. - Reason: The instruction contains multiple steps but they are not broken down into numbered subtasks.
</pre></div>
</div>
</div>
</div>
</section>
<section id="rewrite">
<h2>Rewrite<a class="headerlink" href="#rewrite" title="Permalink to this heading">#</a></h2>
<p>Here’s what an example rewrite prompt looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_rewrite_prompt</span><span class="p">(</span><span class="n">naive_responses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">critiques</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">human_message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Here is an instruction to an AI agent which acts as a Copy Editor:

&lt;instruction&gt;
 Check text for spelling and grammar issues.
&lt;/instruction&gt;

The instruction is supposed to follow certain rules, but it breaks them as follows:

&lt;issues&gt;
 The instruction breaks the following rules:

1. Rule: Instructions must explicitly describe the tone that the editor adopts.  
         - Reason: The instruction does not specify the tone that the editor should adopt.

2. Rule: Instructions must explicitly state the number of words that editor&#39;s written response should be, and the number of words should be appropriate for the task.
         - Reason: The instruction does not specify the number of words in the editor&#39;s response.

3. Rule: Instructions should explicitly reference the article content at the beginning, for example &#39;Here is an article:  
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;
[Rest of instruction goes here].&#39;
         - Reason: The instruction does not reference any article content.

4. Rule: Instructions which involve multiple steps should be broken down into numbered subtasks.
         - Reason: The instruction consists of a single step and is not broken down into numbered subtasks.
&lt;/issues&gt;

Rewrite the instruction to address these issues. Do not enclose your answer in &lt;instruction&gt; tags.
</pre></div>
</div>
</div>
</div>
<p>Now let’s execute the rewrite prompt on each of the naive responses:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_rewrite</span><span class="p">(</span><span class="n">naive_response</span><span class="p">,</span> <span class="n">critique</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_claude_response</span><span class="p">(</span><span class="n">get_rewrite_prompt</span><span class="p">(</span><span class="n">naive_response</span><span class="p">,</span> <span class="n">critique</span><span class="p">))</span>

<span class="c1"># Concurrently:</span>
<span class="c1"># with concurrent.futures.ThreadPoolExecutor() as executor:</span>
<span class="c1">#     rewrites = list(executor.map(lambda x: get_rewrite(x[0], x[1], x[2]), [</span>
<span class="c1">#         (response, critique, i) for i, (response, critique) in enumerate(zip(naive_responses, critiques))]))</span>


<span class="c1"># Sequentially:</span>
<span class="n">rewrites</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">naive_response</span><span class="p">,</span> <span class="n">critique</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">naive_responses</span><span class="p">,</span> <span class="n">critiques</span><span class="p">)):</span>
    <span class="n">rewrites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_rewrite</span><span class="p">(</span><span class="n">naive_response</span><span class="p">,</span> <span class="n">critique</span><span class="p">))</span>

<span class="n">rewriteString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">===</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NAIVE RESPONSE:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">REWRITE:</span><span class="se">\n</span><span class="si">{</span><span class="n">rewrite</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">rewrite</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">naive_responses</span><span class="p">,</span> <span class="n">rewrites</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rewriteString</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NAIVE RESPONSE:
 Check text for spelling and grammar issues.

REWRITE:
 Check text for spelling and grammar issues, adopting a polite and professional tone. Provide a concise response of no more than 50 words summarizing the key issues found.

1. Examine the article for any spelling mistakes. Mark each misspelled word.  

2. Check sentences for grammatical errors such as incorrect punctuation, run-on sentences, subject-verb agreement errors, and tense inconsistencies. Mark each error found.

3. Summarize the main spelling and grammar issues found in no more than  50 words. Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;


===


NAIVE RESPONSE:
 Revise text for consistent style, format, and word choice throughout.

REWRITE:
 Revise the following article for consistent style, format, and word choice throughout in a professional and formal tone:  

Here is an article:  
&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

1. Check for consistent verb tense, noun form, and spelling throughout the article.   

2. Replace redundant or unnecessary words to make the writing more concise, while keeping the meaning intact.  Aim for no more than 50 replaced words.

3. Ensure formatting of headings, lists, quotes, and references is consistent with standard styles. Make any needed corrections.

4. Check that similar concepts are referred to using consistent terms and word choices throughout the article. Replace inconsistent terms with the most common term.


===


NAIVE RESPONSE:
 Verify that all facts and quotations within the text are accurate.

REWRITE:
 Verify that all facts and quotations within the text are accurate, adopting a neutral and professional tone. Your response should be between 50 and 100 words.   

Here is the article:

&lt;article&gt;
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris eget arcu sed erat ullamcorper ullamcorper. Aliquam erat volutpat. 
&lt;/article&gt;

1. Check all facts mentioned within the article, including names, dates, locations and statistics.  
2. Verify that any quotations are attributed correctly and match the original source material.
3. Summarize any factual errors or incorrect quotations found in 1-2 sentences.


===


NAIVE RESPONSE:
 Revise text to resolve ambiguity and clarify meaning.

REWRITE:
 Revise the following article to resolve ambiguity and clarify meaning, adopting a professional yet friendly tone:  

Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

1. Identify any ambiguous phrases, sentences, or paragraphs in the first 200 words.

2. For each instance of ambiguity identified, suggest a revision in 30 words or less that resolves the ambiguity and improves clarity of meaning, while maintaining the author&#39;s intended tone and style.   

3. Review the entire article and identify any additional instances of ambiguity beyond the first 200 words. Follow the same revision process as in step 2 for these instances.   

4. In total, provide no more than 10 revisions to the article, with each revision being  30 words or less.


===


NAIVE RESPONSE:
 Restructure and reorder content to improve clarity and flow. Provide recommendations in writing.

REWRITE:
 The tone the editor should adopt should be professional yet considerate. Provide up to 200 words of written recommendations with the following subtasks:   

1. Assess the overall structure and organization of the provided article. Identify any issues with flow, transitions, or grouping of content.

2. Recommend ways to improve the structure by rearranging, combining, or splitting sections. Number each suggestion.

3. Point out any content that may be redundant or unnecessary and recommend removing or rephrasing it.

Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;   

Follow the above guidelines when providing your written recommendations.
</pre></div>
</div>
</div>
</div>
</section>
<section id="rewrites-as-few-shot">
<h2>Rewrites as few-shot<a class="headerlink" href="#rewrites-as-few-shot" title="Permalink to this heading">#</a></h2>
<p>This is to mimic a retrained model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">few_shot_prompt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">concept</span><span class="p">,</span> <span class="n">rewrite</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">concepts</span><span class="p">,</span> <span class="n">rewrites</span><span class="p">)):</span>
    <span class="n">few_shot_prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">anthropic</span><span class="o">.</span><span class="n">HUMAN_PROMPT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">get_naive_response_prompt</span><span class="p">(</span><span class="n">concept</span><span class="p">)</span><span class="o">.</span><span class="n">human_message</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">few_shot_prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">anthropic</span><span class="o">.</span><span class="n">AI_PROMPT</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">few_shot_prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">rewrite</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">few_shot_prompt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Human: I have an AI agent which acts as a Copy Editor and I want it to complete the following task:

&lt;task&gt;
Check for spelling and grammatical errors.
&lt;/task&gt;

The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.

Assistant:  Check text for spelling and grammar issues, adopting a polite and professional tone. Provide a concise response of no more than 50 words summarizing the key issues found.

1. Examine the article for any spelling mistakes. Mark each misspelled word.  

2. Check sentences for grammatical errors such as incorrect punctuation, run-on sentences, subject-verb agreement errors, and tense inconsistencies. Mark each error found.

3. Summarize the main spelling and grammar issues found in no more than  50 words. Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

Human: I have an AI agent which acts as a Copy Editor and I want it to complete the following task:

&lt;task&gt;
Ensure consistency in style, formatting, and terminology.
&lt;/task&gt;

The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.

Assistant:  Revise the following article for consistent style, format, and word choice throughout in a professional and formal tone:  

Here is an article:  
&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

1. Check for consistent verb tense, noun form, and spelling throughout the article.   

2. Replace redundant or unnecessary words to make the writing more concise, while keeping the meaning intact.  Aim for no more than 50 replaced words.

3. Ensure formatting of headings, lists, quotes, and references is consistent with standard styles. Make any needed corrections.

4. Check that similar concepts are referred to using consistent terms and word choices throughout the article. Replace inconsistent terms with the most common term.

Human: I have an AI agent which acts as a Copy Editor and I want it to complete the following task:

&lt;task&gt;
Verify facts and quotations within the text.
&lt;/task&gt;

The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.

Assistant:  Verify that all facts and quotations within the text are accurate, adopting a neutral and professional tone. Your response should be between 50 and 100 words.   

Here is the article:

&lt;article&gt;
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris eget arcu sed erat ullamcorper ullamcorper. Aliquam erat volutpat. 
&lt;/article&gt;

1. Check all facts mentioned within the article, including names, dates, locations and statistics.  
2. Verify that any quotations are attributed correctly and match the original source material.
3. Summarize any factual errors or incorrect quotations found in 1-2 sentences.

Human: I have an AI agent which acts as a Copy Editor and I want it to complete the following task:

&lt;task&gt;
Identify and resolve ambiguous or unclear phrases.
&lt;/task&gt;

The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.

Assistant:  Revise the following article to resolve ambiguity and clarify meaning, adopting a professional yet friendly tone:  

Here is an article:   
 &lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

1. Identify any ambiguous phrases, sentences, or paragraphs in the first 200 words.

2. For each instance of ambiguity identified, suggest a revision in 30 words or less that resolves the ambiguity and improves clarity of meaning, while maintaining the author&#39;s intended tone and style.   

3. Review the entire article and identify any additional instances of ambiguity beyond the first 200 words. Follow the same revision process as in step 2 for these instances.   

4. In total, provide no more than 10 revisions to the article, with each revision being  30 words or less.

Human: I have an AI agent which acts as a Copy Editor and I want it to complete the following task:

&lt;task&gt;
Make recommendations for restructuring or reorganizing the content for clarity and flow.
&lt;/task&gt;

The agent only responds with written text. Write a concise instruction for the agent, asking it to complete this task. Don&#39;t include any preamble, just respond directly with the instruction for the agent.

Assistant:
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">few_shot_response</span> <span class="o">=</span> <span class="n">anthropic_client</span><span class="o">.</span><span class="n">completion</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">few_shot_prompt</span><span class="p">,</span>
    <span class="n">stop_sequences</span><span class="o">=</span><span class="p">[</span><span class="n">anthropic</span><span class="o">.</span><span class="n">HUMAN_PROMPT</span><span class="p">],</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">max_tokens_to_sample</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">few_shot_response</span><span class="p">[</span><span class="s1">&#39;completion&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Suggest improvements to the structure and organization of the following article in a professional and constructive manner:

Here is an article:
&lt;article&gt;ARTICLE_CONTENT&lt;/article&gt;

1. Identify any issues with the logical flow or progression of ideas in the first 200 words.   

2. For each issue identified, recommend a restructuring in no more than 30 words that improves the clarity and flow of the content, while maintaining the author&#39;s intended meaning.

3. Review the entire article and identify any additional issues with structure or organization beyond the first 200 words. Provide restructuring recommendations following the same guidelines as in step 2.   

4. In total, provide no more than 10 restructuring recommendations for the entire article, with each recommendation being no more than 30 words.
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="prompt-generation-claude-v1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CAI Claude</p>
      </div>
    </a>
    <a class="right-next"
       href="README.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CAI Prompt</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-concepts">Generate concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-naive-responses">Generate naive responses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#critique">Critique</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewrite">Rewrite</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewrites-as-few-shot">Rewrites as few-shot</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dan Kwiatkowski
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>